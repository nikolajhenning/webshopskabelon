!function(a,b){"use strict";if(a&&a.customize){var c=a.customize;c.SMM=c.SMM||{},c.SMM.WidgetModel=Backbone.Model.extend({defaults:{id:null,x:null,y:null,w:null,h:null},initialize:function(){this.on("change",this.maybeChangeState)},maybeChangeState:function(){c.state("saved").get()&&c.state("saved").set(!1)}})}}(window.wp,jQuery),function(a,b){"use strict";if(a&&a.customize){var c=a.customize;c.SMM=c.SMM||{},c.SMM.WidgetsCollection=Backbone.Collection.extend({model:c.SMM.WidgetModel})}}(window.wp,jQuery),function(a,b){"use strict";if(a&&a.customize){var c=a.customize;c.SMM=c.SMM||{},c.SMM.MegaMenuModel=Backbone.Model.extend({defaults:{item_id:null,active:!0,widgets:null},initialize:function(){var a,b,d=this.get("item_id");jQuery.map(c.SMM.data.savedMegaMenus,function(b){b.item_id===d&&(a=b)}),a?(b=_.sortBy(a.widgets,"y"),this.set({widgets:new c.SMM.WidgetsCollection(b),active:a.active})):this.set({widgets:new c.SMM.WidgetsCollection}),this.on("change",this.maybeChangeState)},maybeChangeState:function(){c.state("saved").get()&&c.state("saved").set(!1)}})}}(window.wp,jQuery),function(a,b){"use strict";if(a&&a.customize){var c=a.customize;c.SMM=c.SMM||{},c.SMM.MegaMenusCollection=Backbone.Collection.extend({model:c.SMM.MegaMenuModel})}}(window.wp,jQuery),function(a,b){"use strict";if(a&&a.customize){var c=a.customize;c.SMM=c.SMM||{},c.SMM.MenuCustomizerView=a.Backbone.View.extend({el:"#customize-theme-controls",events:{"click .control-section-nav_menu h3":"setupUI","click .customize-section-back":"killSwitch","click .smm-menu-configure":"configureMegaMenu","click .item-delete":"closeConfigurator","click .reorder-toggle":"closeConfigurator","click .add-new-menu-item":"closeConfigurator"},configurator:null,initialize:function(){var a=this;a.trackNewItems(),a.initConfigurator(),c.previewer.bind("url",a.closeConfigurator)},setupUI:function(){this.addButtons(),this.addActive()},addButtons:function(){var a=this,d=a.$el.find(".customize-control-nav_menu_item");b.each(b(d),function(a,d){var e,f;b(d).find(".smm-menu-configure").length||(e=b(d).attr("id"),e=e.replace("customize-control-nav_menu_item-",""),f=b("<p>").addClass("field-smm smm-field-init"),f.append("<br />"),f.append(b("<button>").addClass("button-secondary smm-menu-configure").attr("data-item-id",e).html(c.SMM.data.l10n.mega_menu)),b(d).find(".menu-item-actions").before(f))})},removeButtons:function(){var a=this;a.$el.find(".field-smm").remove(),a.$el.find(".smm-is-mega-menu").removeClass("smm-is-mega-menu")},trackNewItems:function(){var a=this;b("#available-menu-items").on("click",function(){setTimeout(function(){a.addButtons()},500)})},addActive:function(){var a=this,c=a.$el.find(".customize-control-nav_menu_item");b.each(b(c),function(c,d){var e;e=b(d).attr("id"),e=e.replace("customize-control-nav_menu_item-",""),a.isMegaMenu(e)&&b(d).find(".menu-item-handle").addClass("smm-is-mega-menu")})},initConfigurator:function(){var a=this;a.configurator=new c.SMM.ConfiguratorView,Backbone.on("SMMConfiguratorStatus",a.configuratorStatus,a)},configureMegaMenu:function(a){var c,d;a.preventDefault(),c=b(a.currentTarget),d={item_id:c.data("item-id"),item_title:c.closest(".customize-control-nav_menu_item").find(".menu-item-title").text(),item_top_level:c.closest(".customize-control-nav_menu_item").hasClass("menu-item-depth-0")},Backbone.trigger("SMMLoadMegaMenu",d)},killSwitch:function(){var a=this;a.removeButtons(),a.closeConfigurator()},closeConfigurator:function(){Backbone.trigger("SMMCloseConfigurator")},configuratorStatus:function(a){var b,c=this;b=c.$el.find('.smm-menu-configure[data-item-id="'+a.item_id+'"]'),c.$el.find(".smm-menu-configure-active").removeClass("smm-menu-configure-active"),!0===a.open&&b.addClass("smm-menu-configure-active")},isMegaMenu:function(a){var b=!1;return b=c.SMM.MegaMenusData.find(function(b){return b.get("item_id")===parseInt(a)&&!0===b.get("active")}),b||jQuery.map(c.SMM.data.savedMegaMenus,function(c){parseInt(c.item_id)===parseInt(a)&&!0===c.active&&(b=!0)}),!!b}})}}(window.wp,jQuery),function(a,b){"use strict";if(a&&a.customize){var c=a.customize;c.SMM=c.SMM||{},c.SMM.ConfiguratorView=a.Backbone.View.extend({el:"#smm-configurator",configurator:null,grid:null,model:null,template:null,menuItemID:null,menuItemTitle:"",menuItemisTopLevel:!1,menuItemControl:null,addWidgets:null,widgetViews:[],events:{"click .smm-add-new-widget":"toggleAddWidgets","click .smm-enable-mega-menu":"enableCheckbox"},initialize:function(){var d=this;d.template=a.template("smm-configurator"),d.configurator=d.$el.find(".smm-gridstack"),d.initGridstack(),d.addWidgets=new c.SMM.AddWidgetsView({parent:d}),Backbone.on("SMMLoadMegaMenu",d.loadMegaMenu,d),Backbone.on("SMMCloseConfigurator",d.close,d),b("#customize-controls, #smm-configurator").on("click keydown",function(a){var c=b(a.target).is(".smm-add-new-widget, .smm-add-new-widget *"),e=b(a.target).is(".smm-add-widgets, .smm-add-widgets *");!b(".smm-add-widgets").hasClass("smm-adding-widgets")||e||c||d.closeAddWidgets()})},initGridstack:function(){var a=this;a.grid=a.configurator.gridstack({item_class:"grid-stack-item",width:12,height:10,cell_height:40,cell_width:40,resizable:{handles:"e, w"}}).data("gridstack")},loadMegaMenu:function(a){var b=this;if(b._sameMenuItem(a))return void b.close();b.destroySetting(),b.emptyConfigurator(),b.menuItemID=a.item_id,b.menuItemTitle=a.item_title,b.menuItemisTopLevel=a.item_top_level,b.open()},open:function(){var a=this;a.setupModel(),a.configurator.bind("change",_.bind(a.updateWidgets,a)),this.configurator.closest(".smm-gridstack-wrapper").addClass("smm-grid-empty"),a.render(),b("body").addClass("smm-panel-visible"),a.toggleTopLevelNotice(!1),!1===a.menuItemisTopLevel&&a.toggleTopLevelNotice(!0),a.menuItemControl=c.control("nav_menu_item["+String(a.menuItemID)+"]"),a.menuItemControl&&(a.menuItemSetting=_.bind(a.trackTopLevelNotice,a),a.menuItemControl.setting.bind("change",a.menuItemSetting)),Backbone.trigger("SMMConfiguratorStatus",{open:!0,item_id:a.menuItemID})},close:function(){var a=this;this.configurator.find(".smm-widget-content-visible").animate({height:"40"},200,function(){b(this).removeClass("smm-widget-content-visible"),b(this).width("auto")}),b("body").removeClass("smm-panel-visible"),a.toggleTopLevelNotice(!1),Backbone.trigger("SMMConfiguratorStatus",{open:!1,item_id:a.menuItemID}),b("#accordion-panel-widgets").find(".control-panel-content").css("margin-top","inherit"),a.destroySetting(),a.emptyConfigurator()},emptyConfigurator:function(){var a=this;a.menuItemID=null,a.menuItemTitle="",a.configurator.unbind(),a.menuItemControl&&(a.menuItemControl.setting.unbind("change",a.menuItemSetting),a.menuItemControl=null),_.each(a.grid.grid.nodes,function(b){a.grid.remove_widget(b.el,!1),b.el.hide()})},render:function(){var a,b,c=this;return a=c.model.toJSON(),a.item_title=c.menuItemTitle,!0===a.active&&(a.checked="checked"),c.$el.find(".smm-actions").html(c.template(a)),b=c.model.get("widgets"),_.each(b.models,c.processWidget,c),this.updateWidgets(),c},setupModel:function(){var a,b=this;a=c.SMM.MegaMenusData.find(function(a){return a.get("item_id")===b.menuItemID}),_.isEmpty(a)&&(a=new c.SMM.MegaMenuModel({item_id:b.menuItemID})),this.setActiveMenu(this.menuItemID,a.get("active")),c.SMM.MegaMenusData.add(a),b.model=a},enableCheckbox:function(a){var c;c=b(a.currentTarget),this.model.set({active:c.is(":checked")}),this.setActiveMenu(this.menuItemID,c.is(":checked")),this.updatePreview()},processWidget:function(a){var b,d,e;if(a.id){if(b=this.model.get("widgets").get(a.id),b||this.model.get("widgets").add(a),e=_.find(this.widgetViews,function(b){return b.id===a.id&&b}))return this.grid.add_widget(e.$el,this.model.get("x"),this.model.get("y"),this.model.get("w"),this.model.get("h")),void e.$el.show();d=new c.SMM.WidgetView({parent:this,model:a,id:"smm-widget-"+a.id,className:"grid-stack-widget"}),d.render(),this.widgetViews.push(d)}},updateWidgets:function(){this.maybeToggleEmptyClass(),_.each(this._getGridData(),this.updateSingleWidget,this),this.updatePreview()},updateSingleWidget:function(a){var b=this.model.get("widgets").get(a.id);parseInt(b.get("x"),10)!==parseInt(a.x,10)&&b.set("x",parseInt(a.x,10)),parseInt(b.get("y"),10)!==parseInt(a.y,10)&&b.set("y",parseInt(a.y,10)),parseInt(b.get("w"),10)!==parseInt(a.w,10)&&b.set("w",parseInt(a.w,10)),parseInt(b.get("h"),10)!==parseInt(a.h,10)&&b.set("h",parseInt(a.h,10))},_sameMenuItem:function(a){var b=this;return a.item_id===b.menuItemID},_getGridData:function(){var a;return _.map(this.configurator.find(".grid-stack-item:visible"),function(c){return c=b(c),a=c.data("_gridstack_node"),{id:_.escape(c.attr("data-widget-id")),x:parseInt(a.x,10),y:parseInt(a.y,10),w:parseInt(a.width,10),h:parseInt(a.height,10)}})},toggleAddWidgets:function(a){var c=b(a.currentTarget);a.preventDefault(),c.hasClass("toggled")?this.closeAddWidgets():this.openAddWidgets()},openAddWidgets:function(){var a=b(".smm-add-new-widget"),c=this.addWidgets.$el;a.addClass("toggled"),c.addClass("smm-adding-widgets")},closeAddWidgets:function(){var a=b(".smm-add-new-widget"),c=this.addWidgets.$el;a.removeClass("toggled"),c.removeClass("smm-adding-widgets"),c.find(".smm-widgets-list").scrollTop(0),this.addWidgets.clearSearch()},maybeToggleEmptyClass:function(){var a=!0,b=this._getGridData();b&&0<b.length&&(a=!1),this.configurator.closest(".smm-gridstack-wrapper").toggleClass("smm-grid-empty",a)},trackTopLevelNotice:function(a){var b=this;0!==a.menu_item_parent?b.toggleTopLevelNotice(!0):b.toggleTopLevelNotice(!1)},toggleTopLevelNotice:function(a){this.$el.toggleClass("smm-not-top-level",a)},updatePreview:function(){var a,b,d,e;a="mega_menu["+String(this.menuItemID)+"]",b={type:"mega_menu",transport:"refresh",previewer:c.previewer},d=this.model.toJSON(),d.widgets=d.widgets.toJSON(),e=c.has(a)?c(a):c.create(a,a,{},b),e.callbacks.disable(),_.isEqual(d,e.get())||(e.set(d),e.preview())},destroySetting:function(){var a,b;a="mega_menu["+String(this.menuItemID)+"]",c.has(a)&&(b=c(a),b.callbacks.disable(),b.set(!1),b.preview(),b._dirty=!1)},setActiveMenu:function(a,c){b("#accordion-panel-nav_menus #customize-control-nav_menu_item-"+a).find(".menu-item-handle").toggleClass("smm-is-mega-menu",c)}})}}(window.wp,jQuery),function(a,b){"use strict";if(a&&a.customize){var c=a.customize;c.SMM=c.SMM||{},c.SMM.WidgetView=a.Backbone.View.extend({id:null,id_base:"",title:"",grid:null,widget:null,events:{"click .smm-widget-toggle":"toggleForm","click .widget-control-close":"toggleForm","click .widget-control-remove":"removeWidget","submit #smm-save-widget":"submit","change .form input":"updateWidgetTitle","keyup .form input":"updateWidgetTitle"},initialize:function(a){this.id=this.model.get("id"),this.parent=a.parent,this.grid=a.parent.grid},render:function(){if(!this.id)throw new Error("Widget id was not defined.");return this.widget=c.Widgets.getWidgetFormControlForWidget(this.id),this.widget?(void 0===this.widget.liveUpdateMode&&this.widget.updateWidget(),this.title=this.widget.container.find(".widget-title"),b(this.title).find("h4").length>0&&(this.title=b(this.title).find("h4").html()),b(this.title).find("h3").length>0&&(this.title=b(this.title).find("h3").html()),this.title=b("<h4>").append(this.title),this.$el.attr("data-gs-min-width",2),this.$el.attr("data-widget-id",this.id),this.$el.append(b("<div/>").addClass("grid-stack-item-content").append(this.title).append(b("<button />").addClass("not-a-button smm-widget-toggle")).append(b("<form/>").attr("id","smm-save-widget"))),this.model.get("x")||this.model.get("y")||this.model.get("w")||this.model.get("h")?this.grid.add_widget(this.$el,this.model.get("x"),this.model.get("y"),this.model.get("w"),this.model.get("h")):(this.grid.add_widget(this.$el,0,0,2,1,!0),this.toggleForm()),this.parent.updateWidgets(),this):void this.model.collection.remove(this.model)},toggleForm:function(){var d,e,f,g,h,i,j,k=this;e=b("#smm-configurator"),d=this.$el.find(".grid-stack-item-content"),0===d.find("#smm-save-widget").children().length&&(f=b(this.widget.container).find(".widget-inside"),d.find("#smm-save-widget").append(f),this.widget.liveUpdateMode&&this.$el.find(".widget-control-save").hide(),g=_.debounce(function(a){k.doWidgetUpdate(a)},250),f.find(".form").on("keydown","input",function(a){13===a.which&&(a.preventDefault(),k.doWidgetUpdate(a))}),f.find(".form").on("change input propertychange",":input",function(a){k.widget.liveUpdateMode&&("change"===a.type||this.checkValidity&&this.checkValidity())&&g(a)}),a.mediaWidgets.widgetControls[this.id]&&a.mediaWidgets.widgetControls[this.id].render(),this.widget.setting.previewer.channel.bind("synced",function(){k.isUpdating(!1)}),c.previewer.bind("widget-updated",function(a){a===k.widget.params.widget_id&&k.isUpdating(!1)})),d.hasClass("smm-widget-content-visible")?d.animate({height:"40"},200,function(){d.removeClass("smm-widget-content-visible"),d.removeClass("smm-widget-content-overflow-right"),d.removeClass("smm-widget-content-overflow-left"),d.width("auto")}):(b(".smm-widget-content-visible").not(d).animate({height:"40"},200,function(){b(this).removeClass("smm-widget-content-visible"),b(this).width("auto")}),d.addClass("smm-widget-content-visible"),h=!0===this.widget.params.is_wide?this.widget.params.width:250,h<=d.closest(".grid-stack-item").width()&&(h=!1),h&&0<h&&(i=e.width()+e.offset().left,j=h+d.offset().left,j>=i?d.addClass("smm-widget-content-overflow-right"):b("body").hasClass("rtl")&&d.offset().left-h<=e.offset().left&&d.addClass("smm-widget-content-overflow-left")),h&&0<h?d.animate({width:h},200,function(){d.css("height","auto")}):d.css("height","auto"))},doWidgetUpdate:function(a){var c,d,e=this;c=this.widget.container.find(".widget:first"),this.widget._getInputs(c.find(".widget-inside:first")).serialize()!==this.widget._getInputs(this.$el.find(".widget-inside:first")).serialize()&&(c.find(".widget-inside:first")&&c.find(".widget-inside:first").remove(),d=this.$el.find(".widget-inside:first").clone(),_.each(["select","textarea"],function(a){e.$el.find(".form").find(a).each(function(c){d.find(a).eq(c).val(b(this).val())})}),d.find(".text-widget-fields").remove(),c.find(".move-widget-area:first").after(d),this.isUpdating(!0),this.widget.updateWidget({complete:function(a,b){b&&b.ajaxFinished&&b.noChange&&e.isUpdating(!1)}}))},submit:function(a){return this.doWidgetUpdate(a),!1},removeWidget:function(a){var b,d,e,f,g;a.preventDefault(),c.control.remove(this.widget.id),this.widget.container.remove(),b=c.value("sidebars_widgets[smm-sidebar]")().slice(),d=_.indexOf(b,this.id),-1!==d&&(b.splice(d,1),c.value("sidebars_widgets[smm-sidebar]")(_(b).unique())),c.Widgets.savedWidgetIds[this.id]&&(e=c.value("sidebars_widgets[wp_inactive_widgets]")().slice(),e.push(this.id),c.value("sidebars_widgets[wp_inactive_widgets]")(_(e).unique())),f=this.parseWidgetId(this.widget.id).id_base,g=c.Widgets.availableWidgets.findWhere({id_base:f}),g&&!g.get("is_multi")&&g.set("is_disabled",!1),this.model.collection.remove(this.model),this.grid.remove_widget(this.$el),this.parent.maybeToggleEmptyClass()},updateWidgetTitle:function(a){var c,d=b(a.currentTarget);"widget-"+this.id+"-title"===d.attr("id")&&(c=this.$el.find("h4"),c?c.find(".in-widget-title").text(": "+d.val()):c.append(b("<span />").addClass("in-widget-title").text(": "+d.val())),""===d.val()&&c.find(".in-widget-title").text(""))},isUpdating:function(a){this.$el.find(".grid-stack-item-content").toggleClass("smm-widget-updating",a)},parseWidgetId:function(a){var b,c={number:null,id_base:null};return b=a.match(/^(.+)-(\d+)$/),b?(c.id_base=b[1],c.number=parseInt(b[2],10)):c.id_base=a,c}})}}(window.wp,jQuery),function(a,b){"use strict";if(a&&a.customize){var c=a.customize;c.SMM=c.SMM||{},c.SMM.AddWidgetsView=a.Backbone.View.extend({el:".smm-add-widgets",events:{"click .wp-widget":"addToGrid","input #smm-widgets-filter":"filterWidgets","keyup #smm-widgets-filter":"filterWidgets"},parent:null,widgets:null,searchTerm:"",initialize:function(a){this.parent=a.parent,this.widgets=c.Widgets.availableWidgets,this.listenTo(this.widgets,"change",this.updateList),this.printWidget()},printWidget:function(){var a=this;this.widgets.each(function(c){b('<div class="wp-widget show" data-widget-id-base="'+c.get("id_base")+'"><h3>'+c.get("name")+"</h3><p>"+c.get("description")+"</p></div>").appendTo(a.$el.find(".smm-widgets-list"))})},updateList:function(){this.widgets.each(function(a){b(".wp-widget[data-widget-id-base="+a.get("id_base")+"]").toggleClass("show",a.get("search_matched")&&!a.get("is_disabled"))})},addToGrid:function(a){var d=this.createWPWidget(b(a.currentTarget).closest(".wp-widget").attr("data-widget-id-base")),e=new c.SMM.WidgetModel({id:d.params.widget_id});this.parent.closeAddWidgets(),this.parent.processWidget(e)},createWPWidget:function(a){var b,d,e="sidebars_widgets[smm-sidebar]";return b=c.control(e),d=b.addWidget(a),this.widgets.doSearch(this.searchTerm),d},filterWidgets:function(a){this.searchTerm=a.target.value,this.widgets.doSearch(this.searchTerm)},clearSearch:function(){this.widgets.doSearch(""),this.$el.find("#smm-widgets-filter").val("")}})}}(window.wp,jQuery),function(a,b){"use strict";if(a&&a.customize){var c=a.customize;c.SMM=c.SMM||{},c.SMM.data={savedMegaMenus:{}},"undefined"!=typeof _wpCustomizeSMMSettings&&b.extend(c.SMM.data,_wpCustomizeSMMSettings),c.SMM.MegaMenusData=new c.SMM.MegaMenusCollection,c.bind("ready",function(){_.isUndefined(c.Widgets)||_.isUndefined(c.Menus)||(c.SMM.MegaMenus=new c.SMM.MenuCustomizerView({}),c.bind("saved",function(d){var e,f,g,h=[];d.nav_menu_item_updates&&(b.each(d.nav_menu_item_updates,function(a,b){b.error||"inserted"!==b.status||(g=c.SMM.MegaMenusData.find(function(a){return a.get("item_id")===b.previous_post_id}),_.isEmpty(g)||g.set({item_id:b.post_id}),c.previewer.refresh())}),setTimeout(function(){c.SMM.MegaMenus.addButtons()},500)),c.SMM.MegaMenusData.each(function(a){var b=a.toJSON();b.widgets=b.widgets.toJSON(),b.widgets=_.sortBy(b.widgets,"y"),h.push(b)}),e={data:h,nonce:c.SMM.data.nonce},f=a.ajax.post("smm-save-data",e),f.done(function(a){return"0"===a?(c.previewer.preview.iframe.hide(),void c.previewer.login().done(function(){c.state("saved").set(!1),c.previewer.preview.iframe.show()})):"-1"===a?void c.previewer.cheatin():void 0}),f.fail(function(a){"undefined"!=typeof console&&console.error&&console.error(a)})}))}),c.bind("nonce-refresh",function(a){c.SMM.data.nonce=a["smm-ajax-nonce"]})}}(window.wp,jQuery);
//# sourceMappingURL=storefront-mega-menus.min.js.map